<!-- Responsive gallery partial.

     Example (remove /* */ in template):

     {{/* partial "gallery.html" (dict
     "context" .
     "photos" (first 16 (sort (resources.Match "images/**.{jpeg,h264.mp4}") "Name" "desc")))  */}}

     where CONTEXT is the site context (always .) and PHOTOS is an array of media
     resources in .jpeg or mp4 format.

     must define site params:
     .params.imageThumbQuality
     .params.imageResponsiveWidths

     AUTHOR: Alex Koen
-->

<div id="gallery">
  {{ range $file := .photos }}
    {{ if (eq $file.ResourceType "image") }}
      <!-- IMAGES -->
      {{ $img := $file.Resize "x1024 q90"}}
      {{ $thumb := $img.Fill $.context.Site.Params.imageThumbQuality }}
      {{ $srcset := (partial "srcset.html" $img) }}

      <a class="gallery__item"
         href="{{ $srcset.src }}"
         data-slide-name="{{ .Name | md5 }}"
         data-srcset="{{ $srcset.srcset }}"
         data-sizes="100vw" >
        <img class="lazy gallery__item__img"
             data-src="{{ $thumb.Permalink }}" />
      </a>
    {{ else }}

      {{ $basename := ($file.Name | replaceRE ".*/" "" | replaceRE "\\..*" "") }}
      {{ $thumb := resources.GetMatch (printf "/video-thumbs/%s.jpg" $basename) }}
      {{ $squareThumb := $thumb.Fill $.context.Site.Params.imageThumbQuality }}

      <!-- FIXME: Poster is stretched before video plays -->
      <a class="gallery__item"
         data-slide-name="{{ .Name | md5 }}"
         data-video='{"source": [{"src":"{{- $file.Permalink -}}", "type":"video/mp4"}], "attributes": {"preload": false, "controls": true}}'
         data-poster="{{ $thumb.Permalink }}">
        <img class="lazy gallery__item__img"
             data-src="{{ $squareThumb.Permalink }}"/>
        <i class="fa fa-play gallery__item__play" aria-hidden="true"></i>
      </a>
    {{ end  }}
  {{ end  }}
</div>
