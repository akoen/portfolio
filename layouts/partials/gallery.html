<!-- Responsive gallery partial.

     Example (remove /* */ in template):

     {{/* partial "gallery.html" (dict
     "context" .
     "photos" (first 16 (sort (resources.Match "images/**.{jpeg,h264.mp4}") "Name" "desc")))  */}}

     where CONTEXT is the site context (always .) and PHOTOS is an array of media
     resources in .jpeg or mp4 format.

     must define site params:
     .params.imageThumbQuality
     .params.imageResponsiveWidths

     AUTHOR: Alex Koen
-->

<div id="gallery" class="pswp-gallery">
  {{ range $file := .photos }}
    {{ if (eq $file.ResourceType "image") }}
      <!-- IMAGES -->
      {{ $img := $file}}
      {{ $unloadedThumb := $img.Resize "x1" }}
      {{ $thumb := $img.Resize $.context.Site.Params.imageThumbQuality }}
      {{ $srcset := (partial "srcset.html" $img) }}

      <a class="gallery__item photoswipe-element"
         href="{{ $img.Permalink }}"
         data-pswp-width="{{ $img.Width }}"
         data-pswp-height="{{ $img.Height }}"
         data-pswp-responsive="{{ $srcset.srcset }}"
         data-cropped="true"
         target="_blank"
      >
        <div>
          <img class="lazy gallery__item__img"
               src="{{ $unloadedThumb.Permalink }}"
               data-src="{{ $thumb.Permalink }}"
          />
        </div>
      </a>
    {{ else }}
      <!-- VIDEOS -->
      {{ $basename := ($file.Name | replaceRE ".*/" "" | replaceRE "\\..*" "") }}
      {{ $thumb := resources.GetMatch (printf "/video-thumbs/%s.jpg" $basename) }}
      {{ $unloadedThumb := $thumb.Resize "x1" }}
      {{ $squareThumb := $thumb.Fill $.context.Site.Params.imageThumbQuality }}

      <a class="gallery__item"
         href="{{ $file.Permalink }} "
         >
        <img class="lazy gallery__item__img"
             src="{{ $unloadedThumb.Permalink }}"
             data-src="{{ $thumb.Permalink }}"/>
        <i class="fa fa-play gallery__item__play" aria-hidden="true"></i>
      </a>
    {{ end  }}
  {{ end  }}
</div>

